"use strict";document.getElementsByClassName("control-button")[0].addEventListener("click",function(){window.history.back()}),document.getElementsByClassName("control-button")[1].addEventListener("click",function(){window.history.forward()}),window.globalData={};var indexR=function(){document.getElementsByClassName("container")[0].innerHTML="";var t=function(t){return t.slice(4,6)+"月"+t.slice(6,8)+"日"},e=void 0,n=function(t){var e=new XMLHttpRequest,n=void 0;e.onreadystatechange=function(){4===e.readyState&&(e.status>=200&&e.status<300||304===e.status)&&(n=JSON.parse(e.responseText),t?s(n):s(n,"today"))},t?e.open("get","http://news-at.zhihu.com/api/4/news/before/"+t,!0):e.open("get","http://news-at.zhihu.com/api/4/news/latest",!0),e.send(null)},s=function(n,s){for(var o='<div class="one-day '+n.date+'"><h2>'+("today"===s?"今日热闻":t(n.date))+"</h2>",i=void 0,r=0;r<n.stories.length;r++)o+='\n            <a class="article-list" href="#story/'+n.stories[r].id+'">\n                <img class="article-img" src="img/default.png">\n                <div class="article-title">'+n.stories[r].title+'</div>\n                <div class="article-like"><i class="fa fa-heart-o"></i><span class="like-count">0</span></div>\n            </a>\n        ';o+="</div>",document.getElementsByClassName("container")[0].innerHTML+=o,e=n.date;for(var l=function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(e.status>=200&&e.status<300||304===e.status)&&(i=JSON.parse(e.responseText),document.getElementsByClassName(n.date)[0].getElementsByClassName("article-img")[t].src=i.image,a())},e.open("get","http://news-at.zhihu.com/api/4/news/"+n.stories[t].id,!0),e.send(null)},d=0;d<n.stories.length;d++)l(d);for(var c=function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(e.status>=200&&e.status<300||304===e.status)&&(i=JSON.parse(e.responseText),document.getElementsByClassName(n.date)[0].getElementsByClassName("like-count")[t].innerHTML=i.popularity,a())},e.open("get","http://news-at.zhihu.com/api/4/story-extra/"+n.stories[t].id,!0),e.send(null)},u=0;u<n.stories.length;u++)c(u)},a=function(){window.globalData.indexDate=e,window.globalData.newsHTML=document.getElementsByClassName("container")[0].innerHTML};window.globalData.indexDate&&window.globalData.newsHTML?(e=window.globalData.indexDate,document.getElementsByClassName("container")[0].innerHTML=window.globalData.newsHTML):n(),window.onscroll=function(){window.innerHeight+document.body.scrollTop>=document.body.scrollHeight&&n(e)}},storyR=function(t){window.onscroll=null;var e=new XMLHttpRequest,n=void 0;e.onreadystatechange=function(){4===e.readyState&&(e.status>=200&&e.status<300||304===e.status)&&(document.body.scrollTop=0,n=JSON.parse(e.responseText),document.getElementsByClassName("container")[0].innerHTML=n.body)},e.open("get","http://news-at.zhihu.com/api/4/news/"+t,!0),e.send(null)},routes={"/":indexR,"/story/:storyId":storyR},router=Router(routes);router.init("/");